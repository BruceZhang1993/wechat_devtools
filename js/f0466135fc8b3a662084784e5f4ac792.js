'use strict';!function(require,directRequire){const a=require('fs'),b=require('path'),c=require('zlib'),d=require('rmdir'),e=require('./15ba1827c7f6564a45df6bd44da3a977.js'),f=require('./92320c1386e6db6a6f2556736a9bc280.js'),g=require('./f171257bbcaef547a3cf27266ccb0db2.js'),h=require('./949d8235c744ced2a80121e4dba34c28.js'),i=require('./911222a6723da8db7ca8a8e3689591e1.js'),j=require('./e5fa35c3c8e81bc6466b4b8eb436113b.js'),k=require('./84858de8a097c9cf84ff2c2e3d86e2a9.js'),l=require('./common/locales/index.js'),m=require('./3bfffbe88b3d923921f851c0697974fe.js'),n=require('./72653d4b93cdd7443296229431a7aa9a.js'),o=f.Weappdest,p=require('./da7c31daaf542cf1796023d8e344b98a.js');module.exports=async function(f){let n,q=m.getCurrentConfig(),r=m.getCurrent();try{n=q.setting.MaxCodeSize}catch(a){n=1}let s=1024*n,t=await i(r,{noCompile:!0}),u=b.join(o,`${+new Date}.wx`),v=await j(t,u);a.unlink(u,()=>{});let w=v.data,x=v.pDestPath;d(t,()=>{});let y=parseInt(v.totalSize/1024);if(y>s){let a=new Error(l.config.CODE_SIZE_EXCEED.format([y,s]));throw a.code=h.CODE_SIZE_EXCEED,a}let z;if(f.test){k[`last-up-test-${r.projectid}`]=y,z=global.appConfig.isBeta?`${g.testSourceNewFeatureURL}?gzip=1`:`${g.testSourceURL}?gzip=1`;let{page:a,query:b,searchQuery:c,boxQI:d}=f;if(a){let c=encodeURIComponent(`${a}?${b}`);z=`${z}&path=${c}`}if(c&&(z=`${z}&search_query=${encodeURIComponent(c)}`),d){z=`${z}&search_extInfo=${encodeURIComponent(JSON.stringify({box_qi:d}))}`}}else{k[`last-up-load-${r.projectid}`]=y;let a=encodeURIComponent(f.desc),b=encodeURIComponent(f.version),c=encodeURIComponent(f.uuid);z=global.appConfig.isBeta?`${g.commitSourceNewFeatureURL}?user-version=${b}&user-desc=${a}&uuid=${c}&gzip=1`:`${g.commitSourceURL}?user-version=${b}&user-desc=${a}&uuid=${c}&gzip=1`}let A=c.gzipSync(w);const B=1*new Date;let{body:C}=await e({url:z,method:'post',body:A,needToken:1,needAppID:1});const D=1*new Date;return p(f.test?'client_test_source_time':'client_commit_source_time',r.appid,`${D-B}`),C}}(require('lazyload'),require);