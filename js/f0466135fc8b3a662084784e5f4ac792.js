'use strict';!function(require,directRequire){const a=require('fs'),b=require('path'),c=require('zlib'),d=require('rmdir'),e=require('./15ba1827c7f6564a45df6bd44da3a977.js'),f=require('./92320c1386e6db6a6f2556736a9bc280.js'),g=require('./f171257bbcaef547a3cf27266ccb0db2.js'),h=require('./949d8235c744ced2a80121e4dba34c28.js'),i=require('./911222a6723da8db7ca8a8e3689591e1.js'),j=require('./e5fa35c3c8e81bc6466b4b8eb436113b.js'),k=require('./84858de8a097c9cf84ff2c2e3d86e2a9.js'),l=require('./common/locales/index.js'),m=require('./3bfffbe88b3d923921f851c0697974fe.js'),n=require('./72653d4b93cdd7443296229431a7aa9a.js'),o=f.Weappdest;module.exports=async function(f){let n,p=m.getCurrentConfig(),q=m.getCurrent();try{n=p.setting.MaxCodeSize}catch(a){n=1}let r=1024*n,s=await i(q,{noCompile:!0}),t=b.join(o,`${+new Date}.wx`),u=await j(s,t),v=u.data,w=u.pDestPath;d(s,()=>{});let x=parseInt(v.length/1024);if(x>r){a.unlink(t,()=>{});let b=new Error(l.config.CODE_SIZE_EXCEED.format([x,r]));throw b.code=h.CODE_SIZE_EXCEED,b}let y;if(f.test){k[`last-up-test-${q.projectid}`]=x,y=global.appConfig.isBeta?`${g.testSourceNewFeatureURL}?appid=${q.appid}&gzip=1`:`${g.testSourceURL}?appid=${q.appid}&gzip=1`;let{page:a,query:b,searchQuery:c,boxQI:d}=f;if(a){let c=encodeURIComponent(`${a}?${b}`);y=`${y}&path=${c}`}if(c&&(y=`${y}&search_query=${encodeURIComponent(c)}`),d){y=`${y}&search_extInfo=${encodeURIComponent(JSON.stringify({box_qi:d}))}`}}else{k[`last-up-load-${q.projectid}`]=x;let a=encodeURIComponent(f.desc),b=encodeURIComponent(f.version),c=encodeURIComponent(f.uuid);y=`${g.commitSourceURL}?user-version=${b}&user-desc=${a}&uuid=${c}&gzip=1`}let z=c.gzipSync(v),{body:A}=await e({url:y,method:'post',body:z,needToken:1,needAppID:1});return a.unlink(t,()=>{}),A}}(require('lazyload'),require);