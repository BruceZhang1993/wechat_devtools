'use strict';!function(require,directRequire){function a(a){let b=window.atob(a),c=b.length,d=new Uint8Array(c);for(let e=0;e<c;e++)d[e]=b.charCodeAt(e);return d.buffer}function b(a){let b=new Buffer(a.byteLength),c=new Uint8Array(a);for(let d=0;d<b.length;++d)b[d]=c[d];return b}async function c(a,b){let c=b.args,d=c.tempFilePath,e=c.filePath,f=w.getFileStat(d);if(!f)return{errMsg:`${b.api}:fail file not found`};const g=q.getCurrentConfig(),h=g.setting.MaxFileStorageSize,i=q.getCurrent();let j=w.getSavedFileList(i),k=w.getUsrFileList(i);if(1024*(1024*h)<j.totalSize+k.totalSize+f.size)return{errMsg:`${b.api}:fail exceeded the maximum size of the file storage limit ${h}M`};let l;return e?e&&(l=w.saveUsrFile(i,d,e)):l=w.saveStoreFile(i,d),l.error?{errMsg:`${b.api}:fail ${l.reason}`}:{errMsg:`${b.api}:ok`,savedFilePath:l.savedFilePath}}async function d(a,b){let c=b.args,d=c.filePath,e=c.encoding,f=q.getCurrent(),g=w.readFile(f,d,e);if(g.error)return{errMsg:`${b.api}:fail ${g.reason}`};let h=g.fileData,i={errMsg:`${b.api}:ok`};return e?i.data=h.toString():(i.base64=h.toString('base64'),i.__cover={base64:'data'}),i}async function e(c,d){let e=d.args,f=e.filePath,g=e.data||'',h=e.encoding||'utf8',i=e.__dataisab;i?(g=a(g),g=b(g)):g=g;let j=q.getCurrent();const k=q.getCurrentConfig(),l=k.setting.MaxFileStorageSize;let m=w.getSavedFileList(j),n=w.getUsrFileList(j);if(1024*(1024*l)<m.totalSize+n.totalSize+g.length)return{errMsg:`${d.api}:fail exceeded the maximum size of the file storage limit ${l}M`};let o=w.writeFile(j,f,g,h);return o.error?{errMsg:`${d.api}:fail ${o.reason}`}:{errMsg:`${d.api}:ok`}}async function f(a,b){let c=b.args,d=c.dirPath,e=q.getCurrent(),f=w.mkdir(e,d);return f.error?{errMsg:`${b.api}:fail ${f.reason}`}:{errMsg:`${b.api}:ok`}}async function g(a,b){let c=b.args,d=c.dirPath,e=q.getCurrent(),f=w.rmdir(e,d);return f.error?{errMsg:`${b.api}:fail ${f.reason}`}:{errMsg:`${b.api}:ok`}}async function h(a,b){let c=b.args,d=c.dirPath,e=q.getCurrent(),f=w.readdir(e,d);return f.error?{errMsg:`${b.api}:fail ${f.reason}`}:{errMsg:`${b.api}:ok`,files:f.files}}async function i(a,b){const c=b.args,d=c.srcPath,e=c.destPath||'http://usr',f=q.getCurrent(),g=w.copyFile(f,d,e);return g.error?{errMsg:`${b.api}:fail ${g.reason}`}:{errMsg:`${b.api}:ok`}}async function j(a,b){const c=b.args,d=c.oldPath,e=c.newPath||'http://usr',f=q.getCurrent(),g=w.rename(f,d,e);return g.error?{errMsg:`${b.api}:fail ${g.reason}`}:{errMsg:`${b.api}:ok`}}async function k(a,b){let c=b.args,d=c.path,e=q.getCurrent(),f=w.getFileRealPath(d,e);return n.existsSync(f.fileRealPath)?{errMsg:`${b.api}:ok`}:{errMsg:`${b.api}:fail no such file or directory, access "${d}"`}}async function l(a,b){let c=b.args,d=c.filePath,e=q.getCurrent(),f=w.unlink(e,d);return f.error?{errMsg:`${b.api}:fail ${f.reason}`}:{errMsg:`${b.api}:ok`}}async function m(a,b){let c=b.args,d=c.path,e=q.getCurrent(),f=w.stat(e,d);return f.error?{errMsg:`${b.api}:fail ${f.reason}`}:{errMsg:`${b.api}:ok`,mode:f.mode,size:f.size,lastAccessedTime:f.lastAccessedTime,lastModifiedTime:f.lastModifiedTime}}const n=require('fs'),o=require('path'),p=require('./6242f55dbdfe53c2f07b7a51568311f2.js'),q=require('./3bfffbe88b3d923921f851c0697974fe.js'),r=require('crypto'),{enterBackground:s,enterForeground:t}=require('./a3959bb900db9f65ed2e9c5dfa6977b7.js'),u=require('mkdir-p'),v=require('rmdir'),w=require('./f6cbcecf6ed9f533f6a506310d8f07b6.js'),x={".doc":!0,".xls":!0,".ppt":!0,".pdf":!0,".docx":!0,".xlsx":!0,".pptx":!0};module.exports={saveFile:c,saveFileSync:c,openDocument:async function(a,b){let c=b.args,{filePath:d,fileType:e}=c;1004000>q.getLibVersionNumber()&&(e='');let f=!1;if(!e){let a=o.extname(d).toLowerCase();f=!x[a]}else f=!x[`.${e}`];if(f)return{errMsg:`${b.api}:fail filetype not supported`};let g=w.getFileRealPath(d),h=g.fileRealPath;if(!n.existsSync(h))return{errMsg:`${b.api}:fail file not exist'`};if(s('openDocument'),e){let a=n.readFileSync(h);h=`${h}.${e}`,n.writeFileSync(h,a),nw.Shell.openItem(h)}else nw.Shell.openItem(h);return setTimeout(()=>t('openDocument'),200),{errMsg:`${b.api}:ok`}},getSavedFileList:async function(a,b){let c=q.getCurrent(),d=w.getSavedFileList(c);return{errMsg:`${b.api}:ok`,fileList:d.fileList}},getSavedFileInfo:async function(a,b){let c=b.args,d=w.getFileInfo(c.filePath,'','store');return d.error?{errMsg:`${b.api}:fail ${d.reason}`}:{errMsg:`${b.api}:ok`,size:d.size,createTime:d.createTime}},getFileInfo:async function(a,b){let c=b.args,d=c.filePath,e=c.digestAlgorithm||'md5',f=w.getFileInfo(d,e);return f.error?{errMsg:`${b.api}:fail ${f.reason}`}:{errMsg:`${b.api}:ok`,size:f.size,digest:f.digest}},removeSavedFile:async function(a,b){let c=b.args,d=w.removeSavedFile(c.filePath);return d.error?{errMsg:`${b.api}:fail ${d.reason}`}:{errMsg:`${b.api}:ok`}},base64ToTempFilePath:async function(a,b){let c=b.args;if(c.base64Data){let a=q.getCurrent();const d='jpg'===c.fileType?'.jpg':'.png';let e=w.saveBase64DataToFile(a,c.base64Data,d);if(!e.error)return{errMsg:`${b.api}:ok`,tempFilePath:e.tempFilePath}}return{errMsg:`${b.api}:fail`}},readFile:d,readFileSync:d,writeFile:e,writeFileSync:e,mkdir:f,mkdirSync:f,rmdir:g,rmdirSync:g,readdir:h,readdirSync:h,access:k,accessSync:k,unlink:l,unlinkSync:l,stat:m,statSync:m,unzip:async function(a,b){const c=b.args,d=c.zipFilePath,e=c.targetDirectory||'http://usr',f=q.getCurrent(),g=w.unzip(f,d,e);return g.error?{errMsg:`${b.api}:fail ${g.reason}`}:{errMsg:`${b.api}:ok`}},fs_rename:j,fs_renameSync:j,fs_copyFile:i,fs_copyFileSync:i}}(require('lazyload'),require);