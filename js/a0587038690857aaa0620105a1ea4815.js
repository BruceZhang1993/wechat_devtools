'use strict';!function(require,directRequire){const a=require('fs'),b=require('path'),c=require('./6242f55dbdfe53c2f07b7a51568311f2.js'),d=require('./3bfffbe88b3d923921f851c0697974fe.js'),e=require('./c6f15ef7a40988103528a2ff766b2425.js'),f=require('crypto'),g={".doc":!0,".xls":!0,".ppt":!0,".pdf":!0,".docx":!0,".xlsx":!0,".pptx":!0};module.exports={saveFile:async function(a,b){let c=b.args,f=c.tempFilePath;var g=e.getFileStat(f);if(!f||!g)return{errMsg:`${b.api}:fail file not found`};const h=d.getCurrentConfig(),i=h.setting.MaxFileStorageSize,j=d.getCurrent();let k=e.getSavedFileList();if(1024*(1024*i)<k.totalSize+g.size)return{errMsg:`${b.api}:fail exceeded the maximum size of the file storage limit ${i}M`};let l=e.saveFileForever(f);return!1===l?{errMsg:`${b.api}:fail`}:{errMsg:`${b.api}:ok`,savedFilePath:l}},openDocument:async function(c,d){let f=d.args,{filePath:h,fileType:i}=f,j=!1;if(!i){let a=b.extname(h).toLowerCase();j=!g[a]}else j=!g[`.${i}`];if(j)return{errMsg:`${d.api}:fail filetype not supported`};let k=e.getRealPath(h);if(!a.existsSync(k))return{errMsg:`${d.api}:fail file not exist'`};if(i){let b=a.readFileSync(k);k=`${k}.${i}`,a.writeFileSync(k,b),nw.Shell.openItem(k)}else nw.Shell.openItem(k);return{errMsg:`${d.api}:ok`}},getSavedFileList:async function(a,b){let c=e.getSavedFileList();return{errMsg:`${b.api}:ok`,fileList:c.fileList}},getSavedFileInfo:async function(a,b){let c=b.args,d=e.getFileStat(c.filePath);return d?{errMsg:`${b.api}:ok`,size:d.size,createTime:parseInt(d.ctime.getTime()/1e3)}:{errMsg:`${b.api}:fail file not found`}},getFileInfo:async function(b,c){let d=c.args,g=d.filePath,h=d.digestAlgorithm,i=e.getRealPath(g);if(!a.existsSync(i))return{errMsg:`${c.api}:fail file not found`};let j=e.getFileStat(g);if(j.isDirectory())return{errMsg:`${c.api}:fail filePath is directory`};let k=j.size,l='';if(h){let b=e.getRealPath(g),c=a.readFileSync(b);if('md5'==h){var m=f.createHash('md5');m.update(c),l=m.digest('hex')}else if('sha1'==h){var n=f.createHash('sha1');n.update(c),l=n.digest('hex')}}return{errMsg:`${c.api}:ok`,size:k,digest:l}},removeSavedFile:async function(a,b){let c=b.args,d=e.getFileStat(c.filePath);return d?(e.removeSavedFile(c.filePath),{errMsg:`${b.api}:ok`}):{errMsg:`${b.api}:fail file not found`}},base64ToTempFilePath:async function(a,b){let c=b.args;if(c.base64Data){let a=e.saveBase64DataToFile(c.base64Data,'.png');if(a)return{errMsg:`${b.api}:ok`,tempFilePath:a}}return{errMsg:`${b.api}:fail`}},readFile:async function(c,f){let g,h=f.args,i=h.filePath,j=h.length,k=h.position||0;if(!e.isLocalId(i)){let a=d.getCurrent();g=b.join(a.projectpath,i)}else g=e.getRealPath(i);return a.existsSync(g)?new Promise((b)=>{let c=a.createReadStream(g,{start:k,end:j?k+j:void 0}),e=[];c.on('data',function(a){e.push(a)}),c.on('end',function(){var a=Buffer.concat(e);b({errMsg:'readFile:ok',base64:a.toString('base64'),__cover:{base64:'buffer'}})})}):{errMsg:`${f.api}:fail file not found`}},writeFile:async function(b,c){let d=c.args,f=d.filePath,g=d.data,h=d.position||0,i=e.getRealPath(f);return a.existsSync(i)?new Promise((b)=>{a.open(i,'w',function(d,e){if(d)return void b({errMsg:`${c.api}:fail ${d}`});let f=Buffer.from(g,'base64');a.write(e,f,h,f.length,0,function(a){a?b({errMsg:`${c.api}:fail ${a}`}):b({errMsg:`${c.api}:ok`})})})}):{errMsg:`${c.api}:fail file not found`}}}}(require('lazyload'),require);