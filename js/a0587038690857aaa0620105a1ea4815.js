'use strict';!function(require,directRequire){function a(a){let b=window.atob(a),c=b.length,d=new Uint8Array(c);for(let e=0;e<c;e++)d[e]=b.charCodeAt(e);return d.buffer}function b(a){let b=new Buffer(a.byteLength),c=new Uint8Array(a);for(let d=0;d<b.length;++d)b[d]=c[d];return b}const c=require('fs'),d=require('path'),e=require('./6242f55dbdfe53c2f07b7a51568311f2.js'),f=require('./3bfffbe88b3d923921f851c0697974fe.js'),g=require('crypto'),{enterBackground:h,enterForeground:i}=require('./a3959bb900db9f65ed2e9c5dfa6977b7.js'),j=require('mkdir-p'),k=require('rmdir'),l=require('./f6cbcecf6ed9f533f6a506310d8f07b6.js'),m={".doc":!0,".xls":!0,".ppt":!0,".pdf":!0,".docx":!0,".xlsx":!0,".pptx":!0};module.exports={saveFile:async function(a,b){let c=b.args,d=c.tempFilePath,e=c.filePath,g=l.getFileStat(d);if(!g)return{errMsg:`${b.api}:fail file not found`};const h=f.getCurrentConfig(),i=h.setting.MaxFileStorageSize,j=f.getCurrent();let k=l.getSavedFileList(j),m=l.getUsrFileList(j);if(1024*(1024*i)<k.totalSize+m.totalSize+g.size)return{errMsg:`${b.api}:fail exceeded the maximum size of the file storage limit ${i}M`};let n;return e?e&&(n=l.saveUsrFile(j,d,e)):n=l.saveStoreFile(j,d),n.error?{errMsg:`${b.api}:fail ${n.reason}`}:{errMsg:`${b.api}:ok`,savedFilePath:n.savedFilePath}},openDocument:async function(a,b){let e=b.args,{filePath:f,fileType:g}=e,j=!1;if(!g){let a=d.extname(f).toLowerCase();j=!m[a]}else j=!m[`.${g}`];if(j)return{errMsg:`${b.api}:fail filetype not supported`};let k=l.getFileRealPath(f),n=k.fileRealPath;if(!c.existsSync(n))return{errMsg:`${b.api}:fail file not exist'`};if(h('openDocument'),g){let a=c.readFileSync(n);n=`${n}.${g}`,c.writeFileSync(n,a),nw.Shell.openItem(n)}else nw.Shell.openItem(n);return setTimeout(()=>i('openDocument'),200),{errMsg:`${b.api}:ok`}},getSavedFileList:async function(a,b){let c=f.getCurrent(),d=l.getSavedFileList(c);return{errMsg:`${b.api}:ok`,fileList:d.fileList}},getSavedFileInfo:async function(a,b){let c=b.args,d=l.getFileInfo(c.filePath,'','store');return d.error?{errMsg:`${b.api}:fail ${d.reason}`}:{errMsg:`${b.api}:ok`,size:d.size,createTime:d.createTime}},getFileInfo:async function(a,b){let c=b.args,d=c.filePath,e=c.digestAlgorithm||'md5',f=l.getFileInfo(d,e);return f.error?{errMsg:`${b.api}:fail ${f.reason}`}:{errMsg:`${b.api}:ok`,size:f.size,digest:f.digest}},removeSavedFile:async function(a,b){let c=b.args,d=l.removeSavedFile(c.filePath);return d.error?{errMsg:`${b.api}:fail ${d.reason}`}:{errMsg:`${b.api}:ok`}},base64ToTempFilePath:async function(a,b){let c=b.args;if(c.base64Data){let a=f.getCurrent(),d=l.saveBase64DataToFile(a,c.base64Data,'.png');if(!d.error)return{errMsg:`${b.api}:ok`,tempFilePath:d.tempFilePath}}return{errMsg:`${b.api}:fail`}},readFile:async function(a,b){let c=b.args,d=c.filePath,e=c.encoding,g=f.getCurrent(),h=l.readFile(g,d,e);if(h.error)return{errMsg:`${b.api}:fail ${h.reason}`};let i=h.fileData,j={errMsg:`${b.api}:ok`};return e?j.data=i.toString():(j.base64=i.toString('base64'),j.__cover={base64:'data'}),j},writeFile:async function(c,d){let e=d.args,g=e.filePath,h=e.data||'',i=e.encoding||'utf8',j=e.__dataisab;j?(h=a(h),h=b(h)):h=h;let k=f.getCurrent();const m=f.getCurrentConfig(),n=m.setting.MaxFileStorageSize;let o=l.getSavedFileList(k),p=l.getUsrFileList(k);if(1024*(1024*n)<o.totalSize+p.totalSize+h.length)return{errMsg:`${d.api}:fail exceeded the maximum size of the file storage limit ${n}M`};let q=l.writeFile(k,g,h,i);return q.error?{errMsg:`${d.api}:fail ${q.reason}`}:{errMsg:`${d.api}:ok`}},mkdir:async function(a,b){let c=b.args,d=c.dirPath,e=f.getCurrent(),g=l.mkdir(e,d);return g.error?{errMsg:`${b.api}:fail ${g.reason}`}:{errMsg:`${b.api}:ok`}},rmdir:async function(a,b){let c=b.args,d=c.dirPath,e=f.getCurrent(),g=l.rmdir(e,d);return g.error?{errMsg:`${b.api}:fail ${g.reason}`}:{errMsg:`${b.api}:ok`}},readdir:async function(a,b){let c=b.args,d=c.dirPath,e=f.getCurrent(),g=l.readdir(e,d);return g.error?{errMsg:`${b.api}:fail ${g.reason}`}:{errMsg:`${b.api}:ok`,files:g.files}},access:async function(a,b){let d=b.args,e=d.path,g=f.getCurrent(),h=l.getFileRealPath(e,g);return c.existsSync(h.fileRealPath)?{errMsg:`access:ok`}:{errMsg:`access:fail no such file or directory, access "${e}"`}},unlink:async function(a,b){let c=b.args,d=c.filePath,e=f.getCurrent(),g=l.unlink(e,d);return g.error?{errMsg:`${b.api}:fail ${g.reason}`}:{errMsg:`${b.api}:ok`}},stat:async function(a,b){let c=b.args,d=c.path,e=f.getCurrent(),g=l.stat(e,d);return g.error?{errMsg:`${b.api}:fail ${g.reason}`}:{errMsg:`${b.api}:ok`,mode:g.mode,size:g.size,lastAccessedTime:g.lastAccessedTime,lastModifiedTime:g.lastModifiedTime}}}}(require('lazyload'),require);