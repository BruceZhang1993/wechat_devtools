'use strict';var _extends=Object.assign||function(a){for(var b,c=1;c<arguments.length;c++)for(var d in b=arguments[c],b)Object.prototype.hasOwnProperty.call(b,d)&&(a[d]=b[d]);return a};!function(require,directRequire){const a=require('react'),b=require('redux'),c=require('./1fcc6bd55b687d154a4247e57fe3011d.js'),d=require('./cc2c2970ff81ae4a83123e81ee123da2.js'),e=require('./a8c87029da0fa06e986298d447ab0fe2.js'),f=require('./f0466135fc8b3a662084784e5f4ac792.js'),g=require('./72653d4b93cdd7443296229431a7aa9a.js'),h=require('./d3976cc01aeebc5b09e11c4135b6bd8d.js'),i=require('./53ec6a2d71bd5a4846662679c61fe819.js'),j=require('./875171e7b864aa58d026d4fa0999fbd1.js'),{connect:k}=require('react-redux');class l extends a.Component{constructor(a){super(a),this.state={saveBtnTitle:'\u4E0A\u4F20',version:'',show:a.show,desc:''},this.lock=!1}componentDidMount(){this.props.setMask(!0),this.props.checkUploadStatus()}componentWillUnmount(){this.props.setMask(!1)}componentWillReceiveProps(a){a.show!=this.props.show&&this.setState({show:a.show})}onClose(){this.lock=!1,this.setState({saveBtnTitle:'\u4E0A\u4F20'}),this.setState({show:!1})}onConfirm(){if(!this.state.version)return void this.refs.versionInput.focus();let a=this.state.desc;a||(a=this.getPlaceHolder()),this.lock=!0,this.setState({saveBtnTitle:'\u4E0A\u4F20\u4E2D'}),setTimeout(()=>{f({test:!1,version:this.state.version,desc:a}).then((a)=>{this.onUploadEnd(),this.props.setPkgSize({upload:a.wxpkg_size,lastUploadTime:+new Date})}).catch((a)=>{g.error(`upload ${a}`),this.setState({show:!1}),this.props.setConfirmInfo({show:!0,showCancel:!1,content:`上传错误，原因：${a}`})})})}getPlaceHolder(){let a=new Date;return`${this.props.nickName} 在 ${a.toLocaleDateString()} ${a.toLocaleTimeString()} 提交上传`}onUploadEnd(){this.lock=!1,this.setState({show:!1}),this.props.showSuccessTip('\u4E0A\u4F20\u4EE3\u7801\u6210\u529F')}onInputChange(a){let b=a.currentTarget,c=b.dataset,d=c.name;this.setState({[d]:b.value})}onVersionChange(a){let b=a.target.value;b=b.replace(/[^0-9a-zA-Z\.]/g,''),this.setState({version:b})}onTipsCallback(a){a?this.props.setUploadInfo({status:2}):this.props.setUploadInfo({show:!1,status:0})}onAnimationOut(){this.props.setUploadInfo({show:!1,status:0})}render(){let b=this.props;if(1==b.status)return a.createElement(i,{show:!0,content:this.props.wording,showConfirm:!0,showCancel:!0,callback:this.onTipsCallback.bind(this)});return 2==b.status?a.createElement(j,{show:this.state.show,style:{width:600},inClassName:'ui-animate-pull-down ui-dialog',outClassName:'ui-animate-pull-up ui-dialog',onAnimationOut:this.onAnimationOut.bind(this)},a.createElement('div',{className:'ui-dialog-bd'},a.createElement('div',{className:'ui-form'},a.createElement('div',{className:'ui-form-item ui-form-item-inline'},a.createElement('label',{className:'ui-form-label'},'\u7248\u672C\u53F7'),a.createElement('div',{className:'ui-form-controls'},a.createElement('div',{className:'ui-input-box'},a.createElement('input',{type:'text',ref:'versionInput',value:this.state.version,maxLength:10,"data-name":'version',onChange:this.onVersionChange.bind(this),className:'ui-input'})),a.createElement('p',{className:'ui-form-tips'},'\u4EC5\u9650\u5B57\u6BCD\u3001\u6570\u5B57\u3001. '))),a.createElement('div',{className:'ui-form-item ui-form-item-inline'},a.createElement('label',{className:'ui-form-label'},'\u9879\u76EE\u5907\u6CE8'),a.createElement('div',{className:'ui-form-controls'},a.createElement('div',{className:'ui-input-box'},a.createElement('input',{type:'text',ref:'descInput',value:this.state.desc,maxLength:100,"data-name":'desc',onChange:this.onInputChange.bind(this),placeholder:this.getPlaceHolder(),className:'ui-input'})))))),a.createElement('div',{className:'ui-dialog-ft'},a.createElement('div',{className:'ui-dialog-action'},a.createElement('button',{className:'ui-button ui-button-default',onClick:this.onClose.bind(this)},'\u53D6\u6D88'),a.createElement('button',{className:'ui-button ui-button-primary',onClick:this.onConfirm.bind(this)},this.state.saveBtnTitle)))):null}}module.exports=k((a)=>{let b=a.info.uploadInfo;return _extends({},b,{nickName:a.user.nickName})},(a)=>{return{showSuccessTip:h.bindActionCreators(c.showSuccessTip,a),setUploadInfo:h.bindActionCreators(c.setUploadInfo,a),checkUploadStatus:h.bindActionCreators(d.checkUploadStatus,a),setPkgSize:h.bindActionCreators(d.setPkgSize,a),setMask:h.bindActionCreators(e.setMask,a),setConfirmInfo:h.bindActionCreators(c.setConfirmInfo,a)}})(l)}(require('lazyload'),require);