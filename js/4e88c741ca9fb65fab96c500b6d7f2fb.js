'use strict';!function(require,directRequire){function a(){j({title:`编辑器自动补全有新版本`,message:`新版本已经准备好，立刻重启更新？`,buttons:[{title:'\u91CD\u542F'}],callback:(a)=>{0===a&&chrome.runtime.reload()}})}const b=require('fs'),c=require('zlib'),d=require('asar'),e=require('path'),f=require('child_process').spawn,g=require('./233d77ecf0781f44985f684f70e316d0.js'),h=require('./f171257bbcaef547a3cf27266ccb0db2.js'),i=require('./92320c1386e6db6a6f2556736a9bc280.js'),j=require('./d3ce001ab1e75959382f6a7e0156dd17.js'),k=require('./72653d4b93cdd7443296229431a7aa9a.js'),l=c.createGunzip(),m=require('./dc59f57d54946e61d27c95ab24d8cb4f.js'),n=e.join(i.WeappEditor,'js.api.js'),o=e.join(i.WeappEditor,'js.api.monaco.js'),p=e.join(i.WeappEditor,'component.api.js'),q=e.join(i.WeappEditor,'wxml.api.js'),r=e.join(i.WeappEditor,'lib.wa.es6.js'),s=global.appConfig.isDev?e.join(__dirname,'../extensions/editor/assets/api/js.api.js'):e.join(__dirname,'./extensions/editor/assets/api/js.api.js'),t=global.appConfig.isDev?e.join(__dirname,'../extensions/editor/assets/api/js.api.monaco.js'):e.join(__dirname,'./extensions/editor/assets/api/js.api.monaco.js'),u=global.appConfig.isDev?e.join(__dirname,'../extensions/editor/assets/api/component.api.js'):e.join(__dirname,'./extensions/editor/assets/api/component.api.js'),v=global.appConfig.isDev?e.join(__dirname,'../extensions/editor/assets/api/wxml.api.js'):e.join(__dirname,'./extensions/editor/assets/api/wxml.api.js'),w=global.appConfig.isDev?e.join(__dirname,'../extensions/editor/assets/api/lib.wa.es6.js'):e.join(__dirname,'./extensions/editor/assets/api/lib.wa.es6.js'),x='api_version';let y=localStorage.getItem(x)||'0.0.0.0',z=!1,A=[];const B=()=>new Promise(async(a,c)=>{if(!b.existsSync(n)||!b.existsSync(o)||!b.existsSync(p)||!b.existsSync(q)||!b.existsSync(r))try{await C(),a()}catch(a){c(a)}else a()}),C=()=>new Promise(async(a,c)=>{function d(a){c(a)}function e(){g++,g===f.length&&a()}const f=[[s,n],[t,o],[u,p],[v,q],[w,r]];let g=0;for(const[g,h]of f)b.createReadStream(g).on('error',d).pipe(b.createWriteStream(h).on('error',d).on('close',e))});module.exports={update:(c=!1)=>new Promise((f,j)=>{if(z)return void A.push({resolve:f,reject:j});z=!0;const l=m.get();let n=l&&l.last_api||'0.0.0.0';const o=e.join(i.WeappEditor,`api${n}.asar`),p=b.createWriteStream(o),q=async(a)=>{k.error(`write latest api failed with error ${a}`);try{await B(),await C(),f(i.WeappEditor)}catch(b){j(b);for(const b of A)b.reject(a);z=!1}};p.on('close',async()=>{d.extractAll(o,i.WeappEditor),y=n,localStorage.setItem(x,y),c&&a(),await B(),await C(),f(i.WeappEditor);for(const a of A)a.resolve(i.WeappEditor);z=!1}),p.on('error',q),g({url:`${h.downloadRedirectURL}?type=api`}).on('error',q).pipe(p)}),JSAPIFilePath:n,JSAPIMonacoFilePath:o,ComponentAPIFilePath:p,WXMLAPIFilePath:q,LibWaEs6FilePath:r,fallbackJSAPIPath:s,fallbackJSAPIMonacoPath:t,fallbackComponentAPIPath:u,fallbackWXMLAPIPath:v,fallbackLibWaEs6Path:w,getFallbackAPI:()=>new Promise(async(a)=>{function c(){d()}function d(){f++,f>=e.length&&a(g)}const e=[s,t,u,v,w];let f=0;const g=[];for(const f of e)b.readFile(f,'utf8',(a,b)=>{return a?c():void(g.push(b),d())})}),notifyReload:a,getAPIVersion(){return y}}}(require('lazyload'),require);