'use strict';!function(require,directRequire){function a(){j({title:`编辑器自动补全有新版本`,message:`新版本已经准备好，立刻重启更新？`,buttons:[{title:'\u91CD\u542F'}],callback:(a)=>{0===a&&chrome.runtime.reload()}})}const b=require('fs'),c=require('zlib'),d=require('asar'),e=require('path'),f=require('child_process').spawn,g=require('./233d77ecf0781f44985f684f70e316d0.js'),h=require('./f171257bbcaef547a3cf27266ccb0db2.js'),i=require('./92320c1386e6db6a6f2556736a9bc280.js'),j=require('./d3ce001ab1e75959382f6a7e0156dd17.js'),k=require('./72653d4b93cdd7443296229431a7aa9a.js'),l=c.createGunzip(),m=require('./dc59f57d54946e61d27c95ab24d8cb4f.js'),n=e.join(i.WeappEditor,'js.api.js'),o=e.join(i.WeappEditor,'js.api.monaco.js'),p=e.join(i.WeappEditor,'component.api.js'),q=e.join(i.WeappEditor,'wxml.api.js'),r=global.appConfig.isDev?e.join(__dirname,'../extensions/editor/assets/api/js.api.js'):e.join(__dirname,'./extensions/editor/assets/api/js.api.js'),s=global.appConfig.isDev?e.join(__dirname,'../extensions/editor/assets/api/js.api.monaco.js'):e.join(__dirname,'./extensions/editor/assets/api/js.api.monaco.js'),t=global.appConfig.isDev?e.join(__dirname,'../extensions/editor/assets/api/component.api.js'):e.join(__dirname,'./extensions/editor/assets/api/component.api.js'),u=global.appConfig.isDev?e.join(__dirname,'../extensions/editor/assets/api/wxml.api.js'):e.join(__dirname,'./extensions/editor/assets/api/wxml.api.js'),v='api_version';let w=localStorage.getItem(v)||'0.0.0.0',x=!1,y=[];const z=()=>new Promise(async(a,c)=>{if(!b.existsSync(n)||!b.existsSync(o)||!b.existsSync(p)||!b.existsSync(q))try{await A(),a()}catch(a){c(a)}else a()}),A=()=>new Promise(async(a,c)=>{function d(a){c(a)}function e(){g++,g===f.length&&a()}const f=[[r,n],[s,o],[t,p],[u,q]];let g=0;for(const[g,h]of f)b.createReadStream(g).on('error',d).pipe(b.createWriteStream(h).on('error',d).on('close',e))});module.exports={update:(c=!1)=>new Promise((f,j)=>{if(x)return void y.push({resolve:f,reject:j});x=!0;const l=m.get();let n=l&&l.last_api||'0.0.0.0';const o=e.join(i.WeappEditor,`api${n}.asar`);g({url:`${h.downloadRedirectURL}?type=api`}).on('error',async(a)=>{k.error(`write latest api failed with error ${a}`);try{await z(),f(i.WeappEditor)}catch(b){j(b);for(const b of y)b.reject(a);x=!1}}).on('end',async()=>{d.extractAll(o,i.WeappEditor),w=n,localStorage.setItem(v,w),c&&a(),await z(),f(i.WeappEditor);for(const a of y)a.resolve(i.WeappEditor);x=!1}).pipe(b.createWriteStream(o))}),JSAPIFilePath:n,JSAPIMonacoFilePath:o,ComponentAPIFilePath:p,WXMLAPIFilePath:q,notifyReload:a,getAPIVersion(){return w}}}(require('lazyload'),require);