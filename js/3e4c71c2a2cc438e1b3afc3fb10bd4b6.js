'use strict';!function(require,directRequire){async function a(a,b,c){let{wxmlFiles:d,wxsFiles:e}=p(b,c);return new Promise(async(b,i)=>{let k=m.srcPath,l=d.concat(e),n=!1;e&&0<e.length&&(n=!0,h('wxs_compile',a.appid)),l=l.map((a)=>{return`./${a}`});let o=c?`$${Date.now()}`:'$gwx',p=['-d'].concat(l).concat(['-gn',o]),q=f(j,p,{cwd:k}),r=[],s=[];q.on('close',(c)=>{if(0===c){let a=Buffer.concat(r).toString();return b({code:a,name:o})}n&&h('wxs_compile_fail',a.appid);let d=Buffer.concat(s).toString(),e=new Error(`编译 .wxml 文件错误， 错误信息如上，可在控制台查看更详细信息`);return e.code=g,e.msgForConsole=d,i(e)}),q.stdout.on('data',(a)=>{r.push(a)}),q.stderr.on('data',(a)=>{s.push(a)})})}function b(a,b){let c=d.extname(b);'.wxml'===c||'.wxs'===c?o():'app.json'==b&&o()}async function c(a){let c=await i(a);m&&m.srcPath==c.srcPath||(o(),m&&m.unWatch(b),m=c,m.watch(b))}const d=require('path'),e=require('./d28a711224425b00101635efe1034c99.js'),{spawn:f}=require('child_process'),{TRANS_WXML_JS_ERR:g}=require('./949d8235c744ced2a80121e4dba34c28.js'),h=require('./da7c31daaf542cf1796023d8e344b98a.js'),i=require('./162bf2ee28b76d3b3d95b685cede4146.js'),j=e.getWXMLParsePath(),k=require('./d3976cc01aeebc5b09e11c4135b6bd8d.js'),l=require('./1dea83a77e99a7c94f6b6f01f5c175b0.js');var m,n={comm:'',sub:{}};const o=()=>{n={comm:'',sub:{}}},p=(a,b)=>{let c=m.getAllWXMLFiles(),d=m.getAllWXSFiles();if(a.subPackages){let e=c.filter((b)=>{let c=!0;return a.subPackages.forEach((a)=>{0==b.indexOf(a.root)&&(c=!1)}),c}),f=d.filter((b)=>{let c=!0;return a.subPackages.forEach((a)=>{0==b.indexOf(a.root)&&(c=!1)}),c});b?(c=e.concat(c.filter((a)=>{return 0==a.indexOf(b.root)})),d=f.concat(d.filter((a)=>{return 0==a.indexOf(b.root)}))):(c=e,d=f)}return{wxmlFiles:c,wxsFiles:d}};module.exports=async function(b,d={}){await c(b);let{app:e,page:f}=d,g=await l(b);if(e)return n.comm||(n.comm=await a(b,g)),n.comm;let h=k.checkIsInSubPackage(g,f)||'';return h?(n.sub[h.root]||(n.sub[h.root]=await a(b,g,h)),n.sub[h.root]):{code:'',name:'$gwx'}}}(require('lazyload'),require);