'use strict';var _extends=Object.assign||function(a){for(var b,c=1;c<arguments.length;c++)for(var d in b=arguments[c],b)Object.prototype.hasOwnProperty.call(b,d)&&(a[d]=b[d]);return a};!function(require,directRequire){async function a(a){const b=global.windowMap.get('MAIN').window;let c=document.createElement('input');return c.style.display='none',c.setAttribute('type','file'),a.accept&&c.setAttribute('accept',a.accept),a.multiple&&c.setAttribute('multiple','multiple'),b.document.body.appendChild(c),c.click(),new Promise((a)=>{c.addEventListener('change',(d)=>{b.document.body.removeChild(c),a({success:!0,event:d})}),c.addEventListener('cancel',(d)=>{b.document.body.removeChild(c),a({success:!1,event:d})})})}async function b(a){const b=global.windowMap.get('MAIN').window.document.body;let c=document.createElement('input');return c.style.display='none',c.setAttribute('nwsaveas',a.name||''),c.setAttribute('type','file'),a.accept&&c.setAttribute('accept',a.accept),b.appendChild(c),c.click(),new Promise((a)=>{c.addEventListener('change',(d)=>{b.removeChild(c),a({success:!0,event:d})}),c.addEventListener('cancel',(d)=>{b.removeChild(c),a({success:!1,event:d})})})}function c(a){let b=j.lookup(a);return 0<=b.indexOf('video/')}async function d(a){return new Promise((b)=>{let c=document.createElement('video');c.addEventListener('loadedmetadata',()=>{c.play();let a=parseFloat(c.duration);a=isNaN(a)?0:a;let d=Math.min(100*a,500);setTimeout(()=>{let a=document.createElement('canvas');a.width=c.videoWidth,a.height=c.videoHeight,a.getContext('2d').drawImage(c,0,0,a.width,a.height);let d=a.toDataURL().replace(/^data:image\/(jpg|png);base64,/,''),e=i.saveBase64DataToFile(d,'.jpg');b({duration:c.duration,width:c.videoWidth,height:c.videoHeight,thumbTempFilePath:e})},d)}),c.setAttribute('src',a.replace('wxfile://','http://wxfile.open.weixin.qq.com/')),c.defaultMuted=!0})}var e=Number.isInteger;const f=require('path'),g=require('fs'),h=require('./0634ee2ebd3e560d9d4804ecc960160f.js'),i=require('./c6f15ef7a40988103528a2ff766b2425.js'),j=require('mime-types'),k=require('./3bfffbe88b3d923921f851c0697974fe.js'),l=require('./libs/imagesize.js'),m=require('./e73500972c89345054b507a25d8ccf0b.js');module.exports={chooseVideo:async function(b,c){let d=c.args,e=await a({accept:'video/*'});if(e.success){let a=e.event,b=a.target.value.split(';'),d=[],g=b[0],h=f.extname(g);return d.push(i.copyFileToTemp(g,h)),{errMsg:`${c.api}:ok`,tempFilePath:d[0]}}return{errMsg:`${c.api}:cancel`}},chooseImage:async function(b,c){let d=c.args,h=e(d.count)&&9>=d.count&&1<=d.count?d.count:9,j=await a({accept:'image/*',multiple:1<h});if(j.success){let a=j.event,b=[],d=[],e=a.target.value.split(';');return e=e.slice(0,h),e.forEach((a)=>{let c=f.extname(a);try{let b=g.lstatSync(a);d.push(b.size)}catch(a){return}b.push(i.copyFileToTemp(a,c))}),{errMsg:`${c.api}:ok`,tempFilePaths:b,tempFileSizes:d}}return{errMsg:`${c.api}:cancel`}},previewImage:async function(a,b){return a({type:h.SIMULATOR_SET_PREVIEW_IMAGE,data:{show:!0,urls:b.args.urls||[],current:b.args.current||''}}),{errMsg:`${b.api}:ok`}},getImageInfo:async function(a,b){let c=b.args.src;if(!c)return{errMsg:`${b.api}:fail file not found`};let d=i.isLocalId(c),e=k.getCurrent(),h=await m(e),j=d?i.getRealPath(c):f.join(h.client,c);return g.existsSync(j)?new Promise((a)=>{let c=g.createReadStream(j);l(c,function(c,d){c?a({errMsg:`${b.api}:fail ${c.toString()}`}):a({errMsg:`${b.api}:ok`,width:d.width,height:d.height})})}):{errMsg:`${b.api}:fail file not found`}},chooseMedia:async function(b,h){let j=h.args||{},k=h.api,l=e(j.count)&&9>=j.count&&1<=j.count?j.count:9,m=j.mediaType||['video','image'],n=[],o=!1;0<=m.indexOf('video')&&n.push('video/*'),0<=m.indexOf('image')&&(o=!0,n.push('image/*'));let p=await a({accept:n.join(','),multiple:!!o&&1<l});if(p.success){let a=p.event,b=a.target.value.split(';');b=b.slice(0,l);let e='';b.forEach((a)=>{!e&&c(a)&&(e=a)});let h=[];if(e){let a=e,b=f.extname(a),c=g.statSync(a),h=i.copyFileToTemp(a,b),j=await d(h),l=_extends({tempFilePath:h,size:c.size},j);return{errMsg:`${k}:ok`,type:'video',tempFiles:[l]}}return b.forEach((a)=>{let b=f.extname(a),c=g.statSync(a);h.push({tempFilePath:i.copyFileToTemp(a,b),size:c.size})}),{errMsg:`${k}:ok`,type:'image',tempFiles:h}}return{errMsg:`${k}:cancel`}},saveVideoToPhotosAlbum:async function(a,c){let{api:d,args:e}=c,h=e.filePath,j=i.getRealPath(h);if(!g.existsSync(j))return{errMsg:`${d}:fail file not found`};let k=f.basename(j),l=await b({name:k,accept:'video/*'});if(l.success){let a=l.event,b=a.target.value;return g.writeFileSync(b,g.readFileSync(j)),{errMsg:`${d}:ok`}}return{errMsg:`${d}:cancel`}},saveImageToPhotosAlbum:async function(a,c){let{api:d,args:e}=c,h=e.filePath,j=i.getRealPath(h);if(!g.existsSync(j))return{errMsg:`${d}:fail file not found`};let k=f.basename(j),l=await b({name:k,accept:'image/*'});if(l.success){let a=l.event,b=a.target.value;return g.writeFileSync(b,g.readFileSync(j)),{errMsg:`${d}:ok`}}return{errMsg:`${d}:cancel`}}}}(require('lazyload'),require);