'use strict';!function(require,directRequire){function a(a){return a.replace(A,'').replace(B,'').replace(C,'')}function b(){let a=p.getUserInfo(),b=a?a.openid:'unknow';return b}function c(a,c){let d=a.appid,e=b();if(c||!D[`${d}_${e}`]){let a=j.join(z,e,d);(c||!k.existsSync(a))&&(m.sync(j.join(a,v)),m.sync(j.join(a,w)),m.sync(j.join(a,x))),D[`${d}_${e}`]=!0}}function d(a){return A.test(a)?v:B.test(a)?w:C.test(a)?x:y}function e(a,c,d){let e=a.appid,f=b(),g=l.createHash('md5');return c=c||`${Date.now()}`,g.update(c),`${e}.${f}.${g.digest('hex')}${d}`}function f(a){let c=a.appid,d=b();return j.join(z,d,c)}function g(c,e){let f=d(c);e=e||q.getCurrent();let g;if(f!==y){c=a(c);let d,h;if(f!==v){let a=c.split('.');d=a[0],h=a[1]}else d=e.appid,h=b();g=j.join(z,h,d,f,c)}else{let a=e.miniprogramRoot,b=j.extname(c),d={".wxml":!0,".js":!0,".wxss":!0};'mingganci'!==q.getCurrent().compileType&&(d['.json']=!0),d[b]||(a?g=j.join(e.projectpath,a,c):g=j.join(e.projectpath,c))}return{error:!1,fileRealPath:g,type:f}}function h(a,c,d){let f=e(a,c,d),g=b(),h=j.join(z,g,a.appid,w,f);return k.writeFileSync(h,c),`${t}${f}`}function i(a,b){let c=g(b);if(c.type!==v)return{error:!0,reason:`permission denied, open ${b}`};let d=c.fileRealPath,e=j.dirname(d),f=!1;try{let a=k.lstatSync(e);f=a.isDirectory()}catch(a){}return f?{error:!1,realDirPath:e,fileRealPath:d}:{error:!0,reason:`no such file or directory ${b}`}}const j=require('path'),k=require('fs'),l=require('crypto'),m=require('mkdir-p'),n=require('glob'),o=require('rmdir'),p=require('./89ba85d67a88f7636d657c22b5d3e038.js'),q=require('./3bfffbe88b3d923921f851c0697974fe.js'),{DATA_PATH:r,USER_DATA_PATH:s,TMP_DATA_PATH:t,STORE_DATA_PATH:u}=require('./37be435102276ea9cf47609ff6535cd4.js'),v='usr',w='tmp',x='store',y='package',{WeappFileSystem:z}=require('./92320c1386e6db6a6f2556736a9bc280.js'),A=new RegExp(`^${s}`),B=new RegExp(`^${t}`),C=new RegExp(`^${u}`);var D={},E={saveStoreFile:function(a,b){let c=a.appid,d=g(b);if(d.type===w){let a=d.fileRealPath;if(k.existsSync(a)){let b=j.basename(a),c=k.readFileSync(a),d=j.join(a,'..','..',x,b);return k.writeFileSync(d,c),k.unlink(a,()=>{}),{error:!1,savedFilePath:`${u}${b}`}}}return{error:!0,reason:'tempFilePath file not exist'}},saveUsrFile:function(a,c,d){let e=a.appid,f=b(),h=g(d,a);if(h.type!==v)return{error:!0,reason:`permission denied, open "${d}"`};let i=h.fileRealPath,l=j.dirname(i),m=!1;try{let a=k.lstatSync(l);m=a.isDirectory()}catch(a){}if(!m)return{error:!0,reason:`no such file or directory "${j.dirname(d)}"`};let n=g(c),o=k.readFileSync(n.fileRealPath);return k.writeFileSync(i,o),{error:!1,savedFilePath:d}},copyFileToTemp:function(a,b,c){let d=k.readFileSync(b);return h(a,d,c)},copyFileDataToTemp:h,getUsrFileList:function(a){let c=b(),d=a.appid,e=j.join(z,c,d,x),f={},g=n.sync('**/**',{statCache:f,nodir:!0,stat:!0,cwd:e}),h=0;for(let b in f)h+=f[b].size;return{error:!1,fileList:g,totalSize:h}},getSavedFileList:function(a){let c=b(),d=a.appid,e=j.join(z,c,d,x),f=0,g={},h=n.sync('**/**',{statCache:g,nodir:!0,stat:!0,cwd:e}),i=h.map((a)=>{let b=g[j.join(e,a).replace(/\\/g,'/')];return f+=b.size,{filePath:`${u}${a}`,size:b.size,createTime:parseInt(b.ctime.getTime()/1e3)}});return{error:!1,fileList:i,totalSize:f}},readFile:function(a,b,c){let d=g(b),e=d.fileRealPath;if(!k.existsSync(e))return{error:!0,reason:`readFile:fail ${b} not found`};let f=k.readFileSync(e,c);return{error:!1,fileData:f}},writeFile:function(a,b,c,d='utf8'){let e=i(a,b);if(e.error)return e;let f=e.fileRealPath;return k.existsSync(f)&&k.lstatSync(f).isDirectory()?{error:!0,reason:`illegal operation on a directory, open ${b}`}:(k.writeFileSync(f,c,{encoding:d}),{error:!1})},mkdir:function(a,b){let c=i(a,b);if(c.error)return c;let d=c.fileRealPath;return k.existsSync(d)?{error:!0,reason:`file already exists ${b}`}:(m.sync(d),{error:!1})},rmdir:function(a,c){let d=i(a,c);if(d.error)return d;let e=d.fileRealPath,f=d.realDirPath,g=b();if(f===j.join(z,g,a.appid))return{error:!0,reason:`permission denied, open ${c}`};if(!k.existsSync(e)||!k.lstatSync(e).isDirectory())return{error:!0,reason:`no such file or directory  ${c}`};let h=k.readdirSync(e).filter((a)=>{return 0!==a.indexOf('.')});return 0===h.length?(k.rmdirSync(e),{error:!1}):{error:!0,reason:`directory not empty`}},readdir:function(a,b){let c=i(a,b);if(c.error)return c;let d=c.fileRealPath;if(!k.existsSync(d))return{error:!0,reason:`no such file or directory  ${b}`};if(!k.lstatSync(d).isDirectory())return{error:!0,reason:`not a directory  ${b}`};let e=k.readdirSync(d).filter((a)=>{return 0!==a.indexOf('.')});return{error:!1,files:e}},createTmpfileName:function(a,b){return`${t}${e(a,'',b)}`},initTmpfileName:function(a,b,c){return`${t}${e(a,b,c)}`},getFileSystemDir:f,unlink:function(a,b){let c=g(b,a);if(c.type===y)return{error:!0,reason:`fail permission denied, open "${b}"`};let d=c.fileRealPath;if(!k.existsSync(d))return{error:!0,reason:`fail no such file or directory "${b}"`};let e=k.lstatSync(d);if(e.isDirectory())return{error:!0,reason:`fail operation not permitted, unlink "${b}"`};try{k.unlinkSync(d)}catch(a){return{error:!0,reason:a.toString()}}return{error:!1}},stat:function(a,b){let c=g(b,a);if(c.type===y&&0===b.indexOf(r))return{error:!0,reason:`fail permission denied, open "${b}"`};let d=c.fileRealPath;if(!k.existsSync(d))return{error:!0,reason:`fail no such file or directory "${b}"`};let e=k.lstatSync(d);return{error:!1,mode:e.mode,size:e.size,lastAccessedTime:parseInt(e.atimeMs/1e3),lastModifiedTime:parseInt(e.mtimeMs/1e3)}},saveBase64DataToFile:function(a,c,d){let f=a.appid,g=b(),h=e(a,c,d);return k.writeFileSync(j.join(z,g,f,w,h),c,{encoding:'base64'}),{error:!1,tempFilePath:`${t}${h}`}},clearFileSystem:function(a){let b=f(a);o(b,()=>{c(a,!0)})}};Object.getOwnPropertyNames(E).forEach(function(a){const b=E[a];E[a]=function(){return c(arguments[0]),b.apply(E,arguments)}}),E.getFileRealPath=g,E.removeSavedFile=function(a){let b=g(a),c=b.fileRealPath;if(b.type===x&&k.existsSync(c)){try{k.unlinkSync(c)}catch(a){}return{error:!1}}return{error:!0,reason:'file not exist'}},E.getFileStat=function(a){let b=g(a),c=b.fileRealPath;try{let a=k.statSync(c);return{error:!1,size:a.size,createTime:parseInt(a.ctime.getTime()/1e3)}}catch(a){return{error:!0,reason:'file not found'}}},E.getFileInfo=function(a,b,c){let d=g(a);if(c&&d.type!==c)return{error:!0,reason:'file not find'};let e=d.fileRealPath;if(k.existsSync(e)){let c=k.lstatSync(e);if(c.isDirectory())return{error:!0,reason:`${a} is directory`};let d=k.readFileSync(e),f='';if('md5'===b){let a=l.createHash('md5');a.update(d),f=a.digest('hex')}else if('sha1'===b){let a=l.createHash('sha1');a.update(d),f=a.digest('hex')}return{error:!1,size:c.size,digest:f}}return{error:!0,reason:'file not exist'}},E.USR='usr',E.TMP='tmp',E.STORE='store',E.PACKAGE='package',module.exports=E}(require('lazyload'),require);