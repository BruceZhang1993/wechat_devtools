'use strict';!function(require,directRequire){function a(b){let c=n,d=g.createServer(()=>{});d.on('error',()=>{n++,a(b)}),d.listen(c,'127.0.0.1',()=>{d.once('close',()=>{n=c+1,b(c)}),d.close()})}function b(){let a=c(),b=h.lastVersion;a>b&&(nw.Shell.openExternal(k.NEW_VERSION_LOG),h.lastVersion=a)}function c(a){return a=a||global.appVersion,a=a.replace(/\./g,''),parseInt(a)}function d(){let a=nw.App.getDataPath(),b=f.join(a,'Secure Preferences'),c=e.readFileSync(b,'utf8'),d=JSON.parse(c),{extensions:g}=d,{settings:h}=g,i=chrome.runtime.id,k=h[i];k.events=[],k.filtered_events={},e.writeFileSync(b+'_temp',JSON.stringify(d));let l=require('./d28a711224425b00101635efe1034c99.js'),n=f.join(j.WeappLog,`fixpreferences.log`);e.writeFileSync(b,JSON.stringify(d));let o=m.spawn(l.getFixpreferencesPath(),[b,`${b}_temp`,n,300],{stdio:'ignore',detached:!0});o.unref()}const e=require('fs'),f=require('path'),g=require('http'),h=require('./84858de8a097c9cf84ff2c2e3d86e2a9.js'),i=require('./72653d4b93cdd7443296229431a7aa9a.js'),j=require('./92320c1386e6db6a6f2556736a9bc280.js'),k=require('./f171257bbcaef547a3cf27266ccb0db2.js'),l='darwin'===process.platform,m=require('child_process');var n=9973;module.exports={getAvailablePort:async function(){return new Promise((b)=>{a((a)=>{b(a)})})},getType:function(a){return Object.prototype.toString.call(a).toLowerCase().split(' ')[1].replace(']','')},getAppConfig:function(){return{isDev:!!process.execPath.match('nw.exe')||!!process.execPath.match('nwjs.app')||!!process.execPath.match('nwjs.exe'),isBeta:!0===nw.App.manifest.beta,isGamma:!0===nw.App.manifest.gamma}},checkUpdateApp:async function(){let a=global.appVersion;if(b(),global.appConfig.isDev)return;let d=h.newVersion,g=c(d),k=c(a);if(k<g){i.info(`tools.js currentVersion: ${a} newVersion: ${d} `);let c=j.WeappApplication,g=l?f.join(c,d,'app.nw'):f.join(c,d,'package.nw');if(!e.existsSync(g))return;let k=global.contentDocument.querySelector('#container');return k.innerHTML='<div class="app-up-data">\u66F4\u65B0\u4E2D...</div>',new Promise((a,c)=>{let e=(e)=>{e?(k.innerHTML='<div class="app-up-data">\u66F4\u65B0\u5931\u8D25\uFF0C\u8BF7\u91CD\u65B0\u542F\u52A8</div>',c(e)):(k.innerHTML='',global.appVersion=d,k.innerHTML=`<div class="app-up-data">更新成功，当前版本 ${d}</div>`,global.contentWindow.title=`微信web开发者工具 v${d}`,global.Win.title=`微信web开发者工具 v${d}`,setTimeout(()=>{b(),a()},1e3)),h.removeNewVersion()};if(!l){const a=require('node-windows');let b=`xcopy "${g}" "${f.join(process.execPath,'..','package.nw')}" /s /e /y /i`;console.debug(b),a.elevate(b,e)}else{let a=global.appConfig.isDev?f.join(__dirname,'../../../'):f.join(__dirname,'../..');childProcess.exec(`cp -r "${g}" "${a}"`,e)}})}},openInspectWin:function(){nw.Window.open('about:blank',{show:!1,width:799,height:799},(a)=>{a.maximize(),a.window.location='chrome://inspect/#devices',a.show()})},getVersionNum:c,quit:function(){l&&d(),nw.App.quit()}}}(require('lazyload'),require);